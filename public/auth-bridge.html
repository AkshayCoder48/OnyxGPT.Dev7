<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Puter Auth Bridge</title>
    <script src="https://js.puter.com"></script>
</head>
<body style="background: #0A0A0A; color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0;">
    <div style="text-align: center;">
        <h2 id="status">Connecting to Puter...</h2>
        <p>Please sign in in the popup.</p>
    </div>
    <script>
        const channel = new BroadcastChannel('puter_auth');

        async function handleSignIn() {
            try {
                // Trigger Puter sign-in
                await puter.auth.signIn();

                // Get the token
                const token = puter.auth.getAuthToken();

                if (token) {
                    channel.postMessage({ type: 'AUTH_SUCCESS', token: token });
                    document.getElementById('status').innerText = 'Success!';
                } else {
                    throw new Error('No token received');
                }

                // Close the bridge window
                setTimeout(() => window.close(), 1000);
            } catch (err) {
                console.error('Auth Bridge Error:', err);
                channel.postMessage({ type: 'AUTH_ERROR', error: err.message || 'Unknown error' });
                document.getElementById('status').innerText = 'Authentication Failed';
                setTimeout(() => window.close(), 2000);
            }
        }

        handleSignIn();
    </script>
</body>
</html>
